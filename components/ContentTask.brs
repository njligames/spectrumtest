' Created by: James Folk

sub Init()
    m.top.functionName = "GetContent"
end sub

' Makes a call to the server to return the content.
' Content that is returned is as follows...
' {
'     "record": {
'         "ScreenA": {
'             "logo": "https://corporate.charter.com/sites/default/files/resource-logos/2019-01/preview-images/Spectrum-logo-253x69.png",
'             "title": "Screen A",
'             "numberSet": [
'                 659,
'                 1986,
'                 967,
'                 983,
'                 125,
'                 842,
'                 927,
'                 504,
'                 1934,
'                 1017,
'                 1663,
'                 1007,
'                 1865,
'                 266,
'                 1807,
'                 884,
'                 1389,
'                 1447,
'                 259,
'                 495,
'                 66,
'                 1226,
'                 928,
'                 1120,
'                 493,
'                 128,
'                 1971,
'                 952,
'                 1242,
'                 1574,
'                 205,
'                 1636,
'                 347,
'                 75,
'                 265,
'                 886,
'                 1770,
'                 1488,
'                 381,
'                 1232,
'                 1996,
'                 1275,
'                 877,
'                 36,
'                 988,
'                 209,
'                 318,
'                 1259,
'                 990,
'                 1868,
'                 79,
'                 552,
'                 1480,
'                 913,
'                 204,
'                 1296,
'                 175,
'                 178,
'                 461,
'                 1123,
'                 586,
'                 1210,
'                 325,
'                 1919,
'                 207,
'                 826,
'                 1058,
'                 284,
'                 1772,
'                 1614,
'                 932,
'                 644,
'                 1146,
'                 85,
'                 711,
'                 1908,
'                 773,
'                 1644,
'                 104,
'                 1183,
'                 1615,
'                 1078,
'                 389,
'                 575,
'                 1762,
'                 982,
'                 91,
'                 643,
'                 1766,
'                 655,
'                 362,
'                 1172,
'                 1819,
'                 536,
'                 1158,
'                 1599,
'                 198,
'                 1718,
'                 669,
'                 686,
'                 1611,
'                 1470,
'                 875,
'                 290,
'                 1585,
'                 172,
'                 1436,
'                 950,
'                 596,
'                 1191,
'                 1788,
'                 568,
'                 1703,
'                 1408,
'                 751,
'                 1371,
'                 1901,
'                 1678,
'                 1326,
'                 1016,
'                 1469,
'                 1041,
'                 31,
'                 1534,
'                 426,
'                 94,
'                 419,
'                 1084,
'                 1006,
'                 1262,
'                 437,
'                 313,
'                 487,
'                 1018,
'                 709,
'                 1681,
'                 1499,
'                 1246,
'                 1983,
'                 730,
'                 1651,
'                 340,
'                 1598,
'                 226,
'                 688,
'                 716,
'                 233,
'                 569,
'                 1035,
'                 200,
'                 1991,
'                 600,
'                 1924,
'                 567,
'                 1577,
'                 1363,
'                 1005,
'                 1620,
'                 565,
'                 699,
'                 216,
'                 1502,
'                 286,
'                 593,
'                 456,
'                 182,
'                 445,
'                 1527,
'                 1116,
'                 756,
'                 1513,
'                 335,
'                 1276,
'                 978,
'                 1982,
'                 1175,
'                 645,
'                 1625,
'                 1129,
'                 294,
'                 1063,
'                 689,
'                 1956,
'                 547,
'                 162,
'                 679,
'                 1211,
'                 839,
'                 960,
'                 1670,
'                 74,
'                 1995,
'                 1118,
'                 1802,
'                 1621,
'                 524,
'                 470,
'                 1505,
'                 1594,
'                 1148,
'                 1227,
'                 556,
'                 320,
'                 864,
'                 1103,
'                 759,
'                 1145,
'                 29,
'                 595,
'                 338,
'                 902,
'                 523,
'                 40,
'                 735,
'                 683,
'                 837,
'                 783,
'                 1583,
'                 492,
'                 1170,
'                 843,
'                 1857,
'                 510,
'                 410,
'                 867,
'                 1364,
'                 811,
'                 760,
'                 1361,
'                 386,
'                 380,
'                 156,
'                 1777,
'                 741,
'                 1853,
'                 78,
'                 819,
'                 345,
'                 177,
'                 1927,
'                 851,
'                 1341,
'                 107,
'                 7,
'                 905,
'                 808,
'                 1779,
'                 170,
'                 350,
'                 975
'             ]
'         },
'         "ScreenB": {
'             "logo": "https://corporate.charter.com/sites/default/files/resource-logos/2019-01/preview-images/Spectrum-logo-253x69.png",
'             "title": "Screen B",
'             "numberSet": [
'                 1185,
'                 605,
'                 1044,
'                 312,
'                 678,
'                 330,
'                 1388,
'                 517,
'                 1842,
'                 458,
'                 485,
'                 283,
'                 1992,
'                 786,
'                 1677,
'                 1020,
'                 562,
'                 949,
'                 1807,
'                 937,
'                 299,
'                 294,
'                 719,
'                 704,
'                 309,
'                 1395,
'                 963,
'                 1722,
'                 1765,
'                 178,
'                 339,
'                 559,
'                 663,
'                 1148,
'                 1902,
'                 158,
'                 260,
'                 349,
'                 81,
'                 792,
'                 714,
'                 123,
'                 303,
'                 1582,
'                 1300,
'                 409,
'                 460,
'                 1195,
'                 979,
'                 1835,
'                 331,
'                 1490,
'                 1017,
'                 596,
'                 321,
'                 354,
'                 374,
'                 1235,
'                 1612,
'                 689,
'                 1746,
'                 926,
'                 1138,
'                 1929,
'                 900,
'                 1101,
'                 345,
'                 664,
'                 1660,
'                 1858,
'                 419,
'                 1108,
'                 964,
'                 1392,
'                 1608,
'                 1831,
'                 1584,
'                 244,
'                 1695,
'                 1772,
'                 1557,
'                 263,
'                 1671,
'                 1811,
'                 1544,
'                 1753,
'                 168,
'                 75,
'                 444,
'                 394,
'                 1565,
'                 960,
'                 603,
'                 256,
'                 315,
'                 1714,
'                 1411,
'                 1196,
'                 1618,
'                 476,
'                 480,
'                 881,
'                 890,
'                 375,
'                 1579,
'                 295,
'                 648,
'                 940,
'                 1925,
'                 55,
'                 275,
'                 1405,
'                 471,
'                 1305,
'                 426,
'                 1292,
'                 1472,
'                 474,
'                 261,
'                 1322,
'                 1047,
'                 298,
'                 1325,
'                 795,
'                 1784,
'                 1107,
'                 686,
'                 1732,
'                 1761,
'                 462,
'                 628,
'                 652,
'                 569,
'                 401,
'                 1894,
'                 380,
'                 432,
'                 1211,
'                 1423,
'                 1805,
'                 1433,
'                 580,
'                 1073,
'                 1682,
'                 344,
'                 641,
'                 125,
'                 545,
'                 862,
'                 568,
'                 1911,
'                 1613,
'                 524,
'                 1011,
'                 94,
'                 113,
'                 277,
'                 1057,
'                 1160,
'                 411,
'                 531,
'                 908,
'                 720,
'                 87,
'                 1829,
'                 572,
'                 1674,
'                 1647,
'                 249,
'                 1999,
'                 584,
'                 66,
'                 724,
'                 1130,
'                 169,
'                 1264,
'                 1792,
'                 1750,
'                 1250,
'                 340,
'                 814,
'                 1525,
'                 32,
'                 1797,
'                 1538,
'                 968,
'                 38,
'                 1026,
'                 454,
'                 1814,
'                 1833,
'                 1424,
'                 72,
'                 1616,
'                 1985,
'                 1324,
'                 494,
'                 843,
'                 673,
'                 1548,
'                 1186,
'                 316,
'                 1391,
'                 338,
'                 1120,
'                 1795,
'                 1653,
'                 1133,
'                 1912,
'                 1793,
'                 1394,
'                 213,
'                 1051,
'                 1882,
'                 1201,
'                 1189,
'                 1933,
'                 618,
'                 1473,
'                 1599,
'                 1729,
'                 478,
'                 497,
'                 1071,
'                 1488,
'                 1860,
'                 104,
'                 1000,
'                 399,
'                 1397,
'                 1164,
'                 366,
'                 1652,
'                 1931,
'                 1756,
'                 276,
'                 63,
'                 1286,
'                 141,
'                 1087,
'                 865,
'                 1135,
'                 842,
'                 1659,
'                 1516,
'                 880,
'                 767,
'                 788,
'                 533,
'                 637
'             ]
'         }
'     },
'     "metadata": {
'         "id": "631f5e595c146d63ca98e072",
'         "private": true,
'         "createdAt": "2022-09-12T16:29:13.067Z",
'         "name": "SpectrumChallenge"
'     }
' }
sub GetContent()
    xfer = CreateObject("roURLTransfer")
    xfer.SetCertificatesFile("common:/certs/ca-bundle.crt")
    xfer.AddHeader("X-Access-Key", "$2b$10$aoACF.9P0WVp1wi8w2P.T.WuxaHxuiqzDvHAjg1WgAit2eXUKfJjy")
    xfer.SetURL(getConstants("HOME_URL"))
    
    rsp = xfer.GetToString()
    json = ParseJson(rsp)
    if json <> Invalid
        rootChildren = []

        row = {}
        row.children = []

        record = json["record"]

        row.children.Push(GetItem(record.ScreenA))
        row.children.Push(GetItem(record.ScreenB))

        rootChildren.Push(row)

        contentNode = CreateObject("roSGNode", "ContentNode")
        contentNode.Update({
            children: rootChildren
        }, true)
        m.top.content = contentNode

    end if

end sub

' Retrieve an AssociativeArray of a specific item
function GetItem(item as Object) as Object

    ret = {}
    ret.title = item.title
    ret.logo = item.logo
    ret.numberSet = item.numberSet

    return ret
end function